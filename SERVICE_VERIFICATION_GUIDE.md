# OpenBlock Agent æœåŠ¡éªŒè¯æŒ‡å—

## ğŸ“¡ æœåŠ¡æ¦‚è¿°

OpenBlock Agent å¯åŠ¨åä¼šè¿è¡Œä¸¤ä¸ªæœ¬åœ°æœåŠ¡ï¼š

### 1. **OpenBlock Link Server** (ç«¯å£ 20111)
- **åŠŸèƒ½**: æä¾›ç¡¬ä»¶é€šä¿¡æœåŠ¡ (è“ç‰™ã€ä¸²å£ç­‰)
- **åœ°å€**: `127.0.0.1:20111`
- **åè®®**: WebSocket
- **ç«¯ç‚¹**: 
  - `/scratch/ble` - è“ç‰™ä½åŠŸè€—é€šä¿¡
  - `/scratch/serialport` - ä¸²å£é€šä¿¡

### 2. **OpenBlock Resource Server** (ç«¯å£ 20120)  
- **åŠŸèƒ½**: æä¾›æ‰©å±•å’Œè®¾å¤‡èµ„æºæœåŠ¡
- **åœ°å€**: `0.0.0.0:20120` (å¯é€šè¿‡ localhost è®¿é—®)
- **åè®®**: HTTP
- **ç«¯ç‚¹**:
  - `/extensions/en.json` - æ‰©å±•åˆ—è¡¨
  - `/devices/en.json` - è®¾å¤‡åˆ—è¡¨

## ğŸ” éªŒè¯æœåŠ¡çŠ¶æ€

### æ–¹æ³•1: ä½¿ç”¨éªŒè¯è„šæœ¬
```bash
node verify-services.js
```

### æ–¹æ³•2: æ‰‹åŠ¨æ£€æŸ¥ç«¯å£å ç”¨
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
lsof -i :20111  # Link Server
lsof -i :20120  # Resource Server

# æˆ–ä½¿ç”¨ netstat
netstat -an | grep 20111
netstat -an | grep 20120
```

### æ–¹æ³•3: ç›´æ¥è®¿é—®æœåŠ¡ç«¯ç‚¹
```bash
# æµ‹è¯• Resource Server (HTTP)
curl http://localhost:20120/extensions/en.json
curl http://localhost:20120/devices/en.json

# ä½¿ç”¨æµè§ˆå™¨è®¿é—®
open http://localhost:20120/extensions/en.json
```

## ğŸš€ å¯åŠ¨åº”ç”¨

### å¯åŠ¨æ­¥éª¤ï¼š
1. **åŒå‡»å®‰è£…åŒ…**: å®‰è£… OpenBlock Agent
2. **å¯åŠ¨åº”ç”¨**: ä»åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹æˆ– Launchpad å¯åŠ¨
3. **ç­‰å¾…åˆå§‹åŒ–**: åº”ç”¨éœ€è¦ 10-30 ç§’æ¥åˆå§‹åŒ–æœåŠ¡
4. **æ£€æŸ¥æ‰˜ç›˜å›¾æ ‡**: åº”è¯¥èƒ½åœ¨ç³»ç»Ÿæ‰˜ç›˜çœ‹åˆ° OpenBlock å›¾æ ‡

### é¢„æœŸè¡Œä¸ºï¼š
- âœ… åº”ç”¨æ˜¾ç¤ºåœ¨ç³»ç»Ÿæ‰˜ç›˜
- âœ… ç«¯å£ 20111 å’Œ 20120 è¢«å ç”¨
- âœ… Resource Server å“åº” HTTP è¯·æ±‚
- âœ… Link Server æ¥å— WebSocket è¿æ¥

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: åº”ç”¨æ— æ³•å¯åŠ¨
**å¯èƒ½åŸå› **: Native æ¨¡å—é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**: 
- æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
- ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„æ¶æ„ç‰ˆæœ¬ (arm64 vs x64)

### é—®é¢˜2: ç«¯å£æœªè¢«å ç”¨
**å¯èƒ½åŸå› **: æœåŠ¡å¯åŠ¨å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
1. é‡å¯åº”ç”¨
2. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç¨‹åºå ç”¨ç«¯å£
3. æŸ¥çœ‹åº”ç”¨æ—¥å¿—

### é—®é¢˜3: Resource Server æ— å“åº”
**å¯èƒ½åŸå› **: èµ„æºæ–‡ä»¶ç¼ºå¤±
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤åº”ç”¨å®Œæ•´å®‰è£…
- é‡æ–°å®‰è£…åº”ç”¨

## ğŸ“Š å¥åº·æ£€æŸ¥æ¸…å•

è¿è¡ŒéªŒè¯è„šæœ¬åï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
âœ… ç«¯å£ 20111 æ­£åœ¨è¢«ä½¿ç”¨
âœ… æœåŠ¡å“åº”æ­£å¸¸: WebSocket è¿æ¥æˆåŠŸ

âœ… ç«¯å£ 20120 æ­£åœ¨è¢«ä½¿ç”¨  
âœ… æœåŠ¡å“åº”æ­£å¸¸: HTTP 200
âœ… /extensions/en.json - HTTP 200, æ•°æ®: X é¡¹
âœ… /devices/en.json - HTTP 200, æ•°æ®: X é¡¹
```

## ğŸ”— é›†æˆæµ‹è¯•

### ä½¿ç”¨ Scratch è¿æ¥æµ‹è¯•ï¼š
1. æ‰“å¼€æ”¯æŒ OpenBlock çš„ Scratch ç¼–è¾‘å™¨
2. å°è¯•è¿æ¥ç¡¬ä»¶è®¾å¤‡
3. æ£€æŸ¥æ˜¯å¦èƒ½åŠ è½½æ‰©å±•å’Œè®¾å¤‡

### API æµ‹è¯•ï¼š
```javascript
// WebSocket è¿æ¥æµ‹è¯•
const ws = new WebSocket('ws://127.0.0.1:20111/scratch/ble');
ws.onopen = () => console.log('Link Server è¿æ¥æˆåŠŸ');

// HTTP è¯·æ±‚æµ‹è¯•  
fetch('http://localhost:20120/extensions/en.json')
  .then(res => res.json())
  .then(data => console.log('Resource Server å“åº”æ­£å¸¸', data));
```

## ğŸ“ æ—¥å¿—æŸ¥çœ‹

åº”ç”¨æ—¥å¿—ä½ç½®ï¼š
- **macOS**: `~/Library/Logs/OpenBlock Agent/`
- **Windows**: `%APPDATA%/OpenBlock Agent/logs/`

å…³é”®æ—¥å¿—ä¿¡æ¯ï¼š
- "socket server listend: http://127.0.0.1:20111" - Link Server å¯åŠ¨
- "socket server listend: http://0.0.0.0:20120" - Resource Server å¯åŠ¨
- Native æ¨¡å—è­¦å‘Š (æ­£å¸¸ï¼Œä¸å½±å“åŠŸèƒ½)

## ğŸ¯ æœåŠ¡ç”¨é€”

### Link Server (20111):
- ä¸ Arduinoã€micro:bit ç­‰ç¡¬ä»¶é€šä¿¡
- è“ç‰™è®¾å¤‡å‘ç°å’Œè¿æ¥
- ä¸²å£è®¾å¤‡ç®¡ç†
- å›ºä»¶ä¸Šä¼ 

### Resource Server (20120):
- æä¾›æ‰©å±•åº“åˆ—è¡¨
- è®¾å¤‡å®šä¹‰æ–‡ä»¶
- æœ¬åœ°èµ„æºæœåŠ¡
- ç¦»çº¿æ¨¡å¼æ”¯æŒ 